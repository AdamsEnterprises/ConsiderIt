= form_for :navigate, :url => mobile_navigate_path do |f|
  %div.point_details
    .avatar
      = image_tag @point.user.avatar.url(:midsmall), :alt => "#{h @point.user.name}'s profile picture"
    
    %div
      - if session[@option.id][:included_points].keys.include?(@point.id.to_s)
        = f.submit "Remove Point", :name => "button[remove_point][#{@point.id}]"
      - else
        = f.submit "Add Point", :name => "button[add_point][#{@point.id}]"
    
    .summary
      %h1 Summary
      %p.description #{@point.nutshell}
      %p.author by #{@point.user.name}
    .details
      %h1 Details
      %p.the_details #{ @point.text.empty? ? "None" : @point.text }
    .link
      %h1 External Links
      %ul
        - if @point.point_links.any?
          - @point.point_links.each do |point_link|
            %li 
              = link_to point_link.description, point_link.url
        - else
          %li none provided
    .discuss
      %h1 Discussion (#{@point.comments.count})</h1>
      %ul.comment_section
        - if @point.comments.any?
          - even = false
          - @point.comments.each do |comment|
            %li{ :class => ("even" if even) }
              .avatar
                = image_tag comment.user.avatar.url(:thumb), :alt => "#{h comment.user.name}'s profile picture"
              .comment_text
                = comment.body
                %span.author (by #{comment.user.name})
            - even = !even
        - else
          %li No discussion
        - if current_user
          = f.hidden_field "comment[user_id]", :value => current_user.id
          = f.hidden_field "comment[commentable_type]", :value => "Option"
          = f.hidden_field "comment[commentable_id]", :value => @option.id
          = f.hidden_field "comment[point_id]", :value => @point.id
          %li.even
            .comment_text.pointform
              - if @point.comments.any?
                %p Contribute to this discussion:
              - else
                %p Be the first to discuss this point:
              = f.text_area "comment[body]", :class => "has_example char_limit", :id => "comment_body", :title => "Type your comment here (up to 1000 characters)...", :count => "1000"
              .count Remaining characters: 1000
              %p.note
                %strong Remember your pledge!
              = f.submit "Add comment", :name => "button[add_comment][#{@point.id}]"
  = render :partial => "mobile/partials/nav", :locals => { :id => "nav_bottom", :navigation => @navigation, :include_header => true, :form => f }

